<!--
title: Migrate LTO Keys Between Servers
description: 
published: true
date: 2024-12-06T02:25:07.351Z
tags: gklm
editor: ckeditor
dateCreated: 2024-11-08T06:48:31.786Z
-->

<h2>On NEW SKLM, do the following:</h2>
<p>&nbsp;</p>
<ol>
  <li>Log into the GUI on the new SKLM Server</li>
  <li>Go to <strong>Advanced Configuration â†’ System Certificates</strong></li>
  <li>Click the download button the the certificate used for Key serving (make note of the <strong>Alias</strong>)</li>
</ol>
<figure class="image"><img src="/gklm/gklm_system_cert.png"></figure>
<p>&nbsp; 4. Choose DER as the file type</p>
<figure class="image"><img src="/gklm/gklm_system_cert_der.png"></figure>
<pre><code class="language-plaintext">cd \Program Files\IBM\WebSphere\AppServer\bin&gt;</code></pre>
<p>&nbsp;</p>
<ol>
  <li>Log into the WebSphere CLI</li>
</ol>
<pre><code class="language-plaintext">wsadmin.bat -username SKLMAdmin -password ESI@2022bpic -lang jython</code></pre>
<p>&nbsp;</p>
<ol>
  <li>Create an SSL certificate, say sslCert, on server2 if not previously done:</li>
</ol>
<pre><code class="language-plaintext">print AdminTask.tklmCertCreate ('[-type selfsigned -alias sslCert -cn SSLCert -keyStoreName defaultKeyStore -usage SSLSERVER -validity 9000]')</code></pre>
<p>Where sslCert is an example for an alias label.</p>
<ol>
  <li>List the certificate to verify it is created or if it is already there.</li>
</ol>
<p><code>print AdminTask.tklmCertList()</code></p>
<p><i>Example Output clipped as we care only about the following 3 parameters:</i></p>
<p><i>CTGKM0001I Command succeeded.</i></p>
<p><i>...</i></p>
<p><i>uuid = CERTIFICATE-xxxxxxxx-xxxx-xxx-xxxx-xxxxxxxxxxxx</i></p>
<p><i>alias(es) = sslCert</i></p>
<p><i>key store name(s) = defaultKeyStore</i></p>
<p><i>...</i></p>
<p><i>Make a note of above 3 p</i>arameters as they will be used in the certificate export command:</p>
<ol>
  <li>Export sslCert into a file, say sslCert.der.</li>
</ol>
<p><code>print AdminTask.tklmCertExport ('[-uuid CERTIFICATE-b4741a9-651e699c-8825-4f55-bed6-a37067bed6a0 -format DER -fileName sslCert.der]')</code></p>
<p>CTGKM0001I Command succeeded.</p>
<p>C:\Program Files\IBM\WebSphere\AppServer\products\sklm\data\sslCert.der</p>
<ol>
  <li>Copy sslCert.der file to TKLM server1.</li>
</ol>
<h2>&nbsp;</h2>
<h2>On TKLM server1, do the following:</h2>
<ol>
  <li>Login as LOCAL ADMINISTRATOR</li>
  <li>Change directories:</li>
</ol>
<pre><code class="language-plaintext">cd C:\IBM\tivoli\tiptklmV2\bin</code></pre>
<p>&nbsp;</p>
<ol>
  <li>Log into the Websphere CLI</li>
</ol>
<pre><code class="language-plaintext">wsadmin.bat -username SKLMAdmin -password &lt;put.pwd.here&gt; -lang jython</code></pre>
<p>&nbsp;</p>
<ol>
  <li>List the certificates to get the 'keystore name' on that server1 as it will be used in the import certificate command:</li>
</ol>
<pre><code class="language-plaintext">print AdminTask.tklmCertList()</code></pre>
<p><i>Example Output clipped as we care only about the following parameter:</i></p>
<p><i>CTGKM0001I Command succeeded.</i></p>
<p><i>...</i></p>
<p><i>key store name(s) = defaultKeyStore</i></p>
<p><i>...</i></p>
<ol>
  <li>Import sslCert.der on TKLM server1 that came from SKLM server2</li>
</ol>
<pre><code class="language-plaintext">print AdminTask.tklmCertImport ('[-fileName C:\\migrate\\sklm421.cer -alias tls-cert -format DER -keyStoreName "defaultKeyStore" -usage SSLSERVER]')</code></pre>
<p>&nbsp;</p>
<ol>
  <li>List the certificate to verify it is imported.</li>
</ol>
<pre><code class="language-plaintext">print AdminTask.tklmCertList()</code></pre>
<p><i>Make a note of the following parameters as they will be used in the key export command:</i></p>
<p><i>uuid = CERTIFICATE-xxxc20f3</i></p>
<p><i>alias(es) = sslCert</i></p>
<p><i>key store name(s) = Tivoli Key Lifecycle Manager Keystore</i></p>
<ol>
  <li>List the keys on TKLM server1 to find out which keys to move to SKLM server2:</li>
</ol>
<pre><code class="language-plaintext">print AdminTask.tklmKeyList()</code></pre>
<p>&nbsp;</p>
<ol>
  <li>Export desired key or a range of keys into a file, say exportedKeys, while specifying the SSL certificate alias sslCert.der. Keys should be wrapped by the certificate.</li>
</ol>
<pre><code class="language-plaintext">print AdminTask.tklmKeyExport('[-aliasRange uni00-c7 -fileName C:\\exportedKeys -keyStoreName "Tivoli Key Lifecycle Manager Keystore" -type secretkey -keyAlias sslCert]')</code></pre>
<p><code>&nbsp;</code></p>
<pre><code class="language-plaintext">print AdminTask.tklmKeyExport ('[-fileName c:\\_Install\\mycert.p12 -keyStoreName "Tivoli Key Lifecycle Manager Keystore" -type privatekey]')</code></pre>
<p>&nbsp;</p>
<ol>
  <li>Copy exportedKeys file to SKLM server2.</li>
</ol>
<p>&nbsp;</p>
<h2>On SKLM server2, do the following:</h2>
<p>&nbsp;</p>
<ol>
  <li>Import exportedKeys on SKLM server2 that came from TKLM server1</li>
</ol>
<pre><code class="language-plaintext">print AdminTask.tklmKeyImport ('[-keyAlias sslCert -type secretkey -fileName C:\\exportedKeys -keyStoreName defaultKeyStore -usage LTO]')</code></pre>
<p>&nbsp;</p>
<ol>
  <li>List the keys to verify they are imported.</li>
</ol>
<pre><code class="language-plaintext">print AdminTask.tklmKeyList()</code></pre>
<p>&nbsp;</p>
<ol>
  <li>Create a keygroup on SKLM server2, example name: tklmKeyGroup.</li>
</ol>
<pre><code class="language-plaintext">print AdminTask.tklmGroupCreate ('[-name tklmKeyGroup -type keygroup -usage LTO]')</code></pre>
<p>&nbsp;</p>
<ol>
  <li>List&nbsp;the keygroup to either obtain the name if it was already created or confirm creation:</li>
</ol>
<pre><code class="language-plaintext">print AdminTask.tklmGroupList('[-type keygroup -v y]')</code></pre>
<p>&nbsp;</p>
<ol>
  <li>Add one key into keygroup.</li>
</ol>
<pre><code class="language-plaintext">print AdminTask.tklmGroupEntryAdd('[-name tklmKeyGroup -type keygroup -entry "{type key} {alias aaa000000000000000019} {keyStoreName defaultKeyStore}"]')</code></pre>
<p>&nbsp;</p>
<ol>
  <li>Restart sklm.</li>
</ol>
